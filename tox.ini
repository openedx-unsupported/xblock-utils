[tox]
envlist = py{27,35}-django111,py35-django{20,21,22}

# The ordering of deps and commands here is weird due to the way we install xblock-sdk and associated dependencies.
# Installing test/base.txt inside deps fails, and installing the env-specific Django versions inside deps
# causes Django 1.4 to be installed over it by something later in the process.
[base]
deps =
    -r requirements/test.txt
commands =
    pip install -r {envdir}/src/xblock-sdk/requirements/test.txt
    pip install -r {envdir}/src/xblock-sdk/requirements/base.txt

[testenv]
passenv = 
    CI TRAVIS TRAVIS_* DISPLAY
deps =
    {[base]deps}
commands =
    {[base]commands}
    django111: pip install Django>=1.11,<2.0
    django20: pip install Django>=2.0,<2.1
    django21: pip install Django>=2.1,<2.2
    django22: pip install Django>=2.2,<2.3
    python -Wd -m pytest {posargs}

[testenv:quality]
basepython = python3.5
deps =
    {[base]deps}
commands =
    {[base]commands}
    pycodestyle .
    pylint xblockutils
    python setup.py check -r -s
